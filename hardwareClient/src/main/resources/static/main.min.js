/*! EasyRider build 24-08-2014 */
var app=angular.module("easyrider",["ngRoute"]);app.config(["$locationProvider",function(a){a.html5Mode(!0)}]),app.service("Api",["Connection",function(a){function b(){return f+e++}function c(a){this.subscriptionId=a,this.subscribed=!1,this.snapshot={}}var d=this;d.isAuthenticated=!1;var e=0,f="cmd"+Math.random()+"seq";d.objects={Authenticate:function(){this.jsonClass="easyrider.Api$Authenticate"}},d.authenticate=function(b){a.send(b),d.authObject=b},a.onOpen=function(){d.authObject&&a.send(d.authObject)};var g=[],h=[],i={};d.subscribe=function(e,f){var h=b(),j={jsonClass:"easyrider.Events$Subscribe",commandId:{jsonClass:"easyrider.CommandId",id:b()},subscriptionId:h,eventType:{jsonClass:"easyrider.EventType",name:e},eventKey:{jsonClass:"easyrider.EventKey",key:f.push?f:f.split(" ")}};d.isAuthenticated&&a.send(j),g.push(j);var k=new c(h);return i[h]=k,k.eventKey=j.eventKey,k.eventType=j.eventType,k.commandId=j.commandId,k},d.command=function(c,e){e.jsonClass=c,e.commandId={id:b()},d.isAuthenticated?a.send(e):h.push(e)},a.on["easyrider.Api$Authentication"]=function(){d.isAuthenticated=!0;for(var b in g)a.send(g[b]);for(b in h)a.send(h[b]);h=[]},a.on["easyrider.Events$Subscribed"]=function(a){var b=i[a.subscriptionId];b.subscribed=!0,b.snapshot=a.snapshot}}]),app.service("Applications",["Api",function(a){var b=this;b.subscription=a.subscribe("easyrider.Applications$ApplicationUpdatedEvent",[]),b.list=b.subscription.snapshot,b.addApplication=function(b){console.log(a),a.command("easyrider.Applications$CreateApplication",{application:b})},b.Application=function(a,b){this.id={id:a},this.properties=b}}]),app.service("Connection",["$rootScope",function(a){function b(b){a.$apply(function(){d.on[b.jsonClass]?d.on[b.jsonClass](b):console.error("Unhandled message ",b)})}function c(){d.ws=new WebSocket("ws://"+location.host),d.ws.onclose=function(){d.open=!1,setTimeout(function(){c()},500)},d.ws.onopen=function(){d.open=!0;for(var b in e)d.ws.send(e[b]);e=[],a.$apply(d.onOpen)},d.ws.onmessage=function(a){b(JSON.parse(a.data))}}var d=this;d.open=!1,d.on={};var e=[];d.send=function(a){var b=JSON.stringify(a);d.open?d.ws.send(b):e.push(b)},c()}]),app.config(["$routeProvider",function(a){a.when("/applications",{templateUrl:"/pages/applications/template.html",controller:["$scope","Applications",function(a,b){a.Applications=b,a.addApplication=function(){var a=new b.Application(prompt("Type application name"),[]);b.addApplication(a)}}]})}]),app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"/pages/index/template.html"})}]),app.controller("LoginController",["$scope","Api",function(a,b){a.signIn=function(){b.authenticate(new b.objects.Authenticate)},a.Api=b}]);